!function e(n,o,t){function r(c,a){if(!o[c]){if(!n[c]){var u="function"==typeof require&&require;if(!a&&u)return u(c,!0);if(i)return i(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var d=o[c]={exports:{}};n[c][0].call(d.exports,function(e){var o=n[c][1][e];return r(o?o:e)},d,d.exports,e,n,o,t)}return o[c].exports}for(var i="function"==typeof require&&require,c=0;c<t.length;c++)r(t[c]);return r}({1:[function(){function e(e){function o(e,o){var i=r.get(o);t.create({name:i.get("name"),image:i.get("image"),children:[]},{wait:!0,success:function(o){var r=t.get(e),i=r.get("children");i.push(o.id),r.cbSave({children:i},function(e){return e?console.error(e):(n.createNode(r.id,r.get("name"),r.get("image"),r.get("children")),n.createNode(o.id,o.get("name"),o.get("image"),o.get("children")),n.expandNode(r.id,!0),void n.selectNode(o.id))})},error:function(e,n){console.error("Couldn't create new page"),console.error(n)}})}n=Tree({domID:"tree",rootID:e,iconPath:"images/icons/",onLoad:function(e,n){t.getFetch(e,function(o,t){return o?console.log("Couldn't load page: "+e):void n(null,t.get("name"),t.get("image"),t.get("children"))})},onClick:function(e){console.log("open page: "+e)},onDrop:function(e,n,o,r){var i=t.get(n),c=t.get(o);c.cbSave({children:_.without(c.get("children"),e)},function(n){if(n)return r("Failed to save old parent: "+n);var o=i.get("children");o.push(e),i.cbSave({children:o},function(e){return e?r("Failed to save old parent:"+e):void r()})})},onDropBefore:function(e,n,o,r){console.log("moving: "+e+"\n	previous:"+n);var i=t.get(o);i.cbSave({children:_.without(i.get("children"),e)},function(o){if(o)return r("Couldn't save old parent changes: "+o);var i=t.filter(function(e){return _.contains(e.get("children"),n)});if(0==i.length)return void console.error("No parent found for target.");i.length>1&&console.error("Multiple parents found for target.");var c=i[0],a=c.get("children");a.splice(_.indexOf(a,n),0,e),c.cbSave({children:a},function(e){return e?r("Failed to save old parent: "+e):void r()})})},onRename:function(e,n){t.get(e).cbSave({name:n},function(e){return e?console.error(e):void 0})},onContext:function(e,t){if(e){var i=r.map(function(e){return{name:e.get("name"),icon:e.get("image"),action:function(n){o(n,e.id)}}}),c=[{name:"Rename",action:function(e){n.editNodeName(e)}},{name:"Preview",action:function(e){console.log("Preview page: "+e)}},{name:"Publish",action:function(e){console.log("Publish page: "+e)}},{name:"New...",subs:i},{name:"Delete",action:function(e){console.log("Delete page: "+e),n.deleteNode(e)}},{name:"Properties",action:function(e){console.log("Page properties: "+e)}}];return t(null,c)}return t(null,[])}})}var n,o=new Publications,t=new Pages,r=new Structures;window.onload=function(){async.parallel([function(e){o.cbFetch(e)},function(e){r.cbFetch(e)}],function(n){return n?console.error("Unable to start: "+n):void e(o.at(0).get("rootPage"))})}},{}]},{},[1]);
//# sourceMappingURL=bundle.js.map